var App=angular.module("RatioMedicalAdmin",["ngRoute","ui.router","ngStorage","ngResource","ImageCropper","toaster"]);App.run(["$rootScope","$state","$stateParams","$window","$templateCache",function(e,t,o,a,r){e.$state=t,e.$stateParams=o,e.$storage=a.localStorage,e.$on("$stateChangeStart",function(e,o,a){o.redirectTo&&(e.preventDefault(),t.go(o.redirectTo,a))})}]),App.api="http://medicalratios.net/Menas_health_Api/public/rest-api/v1/",App.config(["$routeProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$urlRouterProvider","$stateProvider","$httpProvider",function(e,t,o,a,r,n,l,i){i.interceptors.push("myHttpInterceptor"),r.factory("redirectWhenLoggedOut",function(e,t){return{responseError:function(o){var a=t.get("$state");return angular.forEach(["token_not_provided","token_expired","token_absent","token_invalid"],function(e,t){o.data.error===e&&(localStorage.removeItem("user"),a.go("Superlogin"))}),e.reject(o)}}})}]),App.factory("myHttpInterceptor",["$q","$rootScope","$location",function(e,t,o){return t.pendingRequests=0,{request:function(e){return e.headers.Authorization="Bearer "+t.auth_token,e.headers["Content-type"]="Access-Control-Allow-Headers",e.headers.Accept="application/json;odata=verbose",e},requestError:function(t){if(!canRecover(t))return e.reject(t)},response:function(e){return e},responseError:function(a){return 404!==a.status&&403!==a.status||(pagealert(a.data.message,{type:"Error",theme:"red",delay:3e3}),t.processing=!1),409===a.status?(pagealert(a.data,{type:"Error",theme:"red",delay:3e3}),e.reject(a)):400===a.status||401===a.status?(pagealert("Your session is expired.",{type:"Error",theme:"red",delay:3e3}),void o.path("/login")):e.reject(a)}}}]),App.directive("fileModel",["$parse","fileReader",function(e,t){return{restrict:"A",template:'<div></div><input type="file"/>',link:function(o,a,r){var n=e(r.fileModel).assign,l=a[0].childNodes[0],i=a[0].childNodes[1];$(i).bind("change",function(){o.$apply(function(){n(o,i.files[0])});var e=!1;if(["jpeg","png","gif","jpg"].forEach(function(t){o[r.fileModel].type.match("image/"+t)&&(e=!0)}),e){var a;a=new Image,t.readAsDataUrl(o[r.fileModel],o).then(function(e){o.imagePreview=!0,a.src=e}),a.class="img-responsive",$(l).html(a)}else alert("file type should be .jpeg, .png, .jpg, .gif")})}}}]),App.factory("fileReader",["$q","$log",function(e,t){return{readAsDataUrl:function(t,o){var a=e.defer();return function(e,t){var o=new FileReader;return o.onload=function(e,t,o){return function(){o.$apply(function(){t.resolve(e.result)})}}(o,e,t),o.onerror=function(e,t,o){return function(){o.$apply(function(){t.reject(e.result)})}}(o,e,t),o.onprogress=function(e,t){return function(e){t.$broadcast("fileProgress",{total:e.total,loaded:e.loaded})}}(0,t),o}(a,o).readAsDataURL(t),a.promise}}}]),App.config(["$routeProvider","$controllerProvider","$compileProvider","$filterProvider","$provide","$urlRouterProvider","$stateProvider","$httpProvider",function(e,t,o,a,r,n,l,i){n.otherwise("/login"),l.state("login",{url:"/login",templateUrl:"templates/login.html",controller:"AuthController"}).state("mainLayout",{url:"",templateUrl:"templates/main-layout.html",controller:"MainController",redirectTo:"login"}).state("mainLayout.profile",{url:"/profile",templateUrl:"templates/profile.html",controller:"ProfileController"}).state("mainLayout.faq",{url:"/faq",templateUrl:"templates/faq.html",controller:"FaqController"}).state("mainLayout.product",{url:"/product",templateUrl:"templates/product.html",controller:"ProductController"}).state("mainLayout.answer",{url:"/answer",templateUrl:"templates/answer.html",controller:"QuestionWithAnsController"}).state("mainLayout.notification",{url:"/notification",templateUrl:"templates/notification.html",controller:"NotificationController"}).state("mainLayout.appointment",{url:"/appointment",templateUrl:"templates/appointment.html",controller:"AppointmentController"}).state("mainLayout.contact",{url:"/contact",templateUrl:"templates/contact.html",controller:"ContactController"}).state("mainLayout.enquery",{url:"/enquery",templateUrl:"templates/enquery.html",controller:"EnqueryController"}).state("mainLayout.question",{url:"/question",templateUrl:"templates/question.html",controller:"QuestionController"}).state("mainLayout.users",{url:"/users",templateUrl:"templates/users.html",controller:"usersController"}).state("mainLayout.about",{url:"/about",templateUrl:"templates/about.html",controller:"AboutController"})}]),App.controller("AboutController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.question="",e.answer="",e.aboutUpdate=function(o){if(e.new_about=o,e.new_about){e.loader=!0;var a={async:!0,crossDomain:!0,url:"http://medicalratios.net/Menas_health_Api/public/rest-api/v1/update/about",method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+r.auth_token_name},processData:!1,data:JSON.stringify(e.new_about),success:function(o){pagealert("About updated successfully!",{type:"Success",theme:"green",delay:3e3}),e.loader=!1,t.reload()},error:function(e){alert("Somthing went wrong!"),t.reload()}};$.ajax(a)}else alert("Please enter about Details!")},e.edit=function(t){console.log(t),e.new_about=t,e.editcat=!0},o.faqs=[],e.loadCategory=function(){e.loader=!0,a.get(App.api+"about").then(function(t){e.about=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})},e.loadCategory()}]),App.controller("AppointmentController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loader=!0,a.get(App.api+"all/appointment").then(function(t){e.appointments=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})}]),App.controller("AuthController",["$state","$http","$rootScope","$scope","$localStorage",function(e,t,o,a,r){a.mobile="",a.password="",a.name="",a.email="",a.login=function(o){r.currentuser={},a.user={},a.user=o,a.user.email&&a.user.password?(console.log(a.user),a.btnDisable=!0,a.loader=!0,t.post(App.api+"admin/login",a.user).then(function(t){a.myres=t.data,a.loader=!1,console.log(a.myres),""!==a.myres&&(r.currentuser=a.myres,alert("You Are Successfully Logged In!",{type:"Success:",theme:"green",delay:3e3}),e.go("mainLayout.profile")),a.btnDisable=!1},function(e){alert(e.data.message,{type:"Error",theme:"red",delay:3e3}),a.btnDisable=!1,a.loader=!1})):(alert("Please enter email & password!",{type:"Error",theme:"red",delay:3e3}),a.btnDisable=!1,a.loader=!1)},a.register=function(){if(""!==a.mobile||""!==a.password){o.processing=!0;var n={mobile:a.mobile,password:a.password,name:a.name,email:a.email};a.password!==a.c_password?alert("Repeat password does not match together"):t.post(App.api+"register",n).then(function(t){r.auth_token_name=o.auth_token_name=t.data,void 0===o.auth_token_name.token&&"Provided Mobile or password dose not match."===o.auth_token_name.message?(alert("Your mobile or password dose not match!"),o.processing=!1,a.password=""):void 0===o.auth_token_name.token&&"It seems that you are not register with us. Please contact service provider."===o.auth_token_name.message?(alert("It seems that you are not register with us. Please contact service provider.!"),o.processing=!1,a.password=""):(r.auth_token=o.auth_token=o.auth_token_name.token,alert("You've successfully Registered!"),e.go("mainLayout.users"),o.processing=!1,a.password="")},function(e){a.password="","user_not_verify"!==e.data&&"user_not_find"!==e.data||(alert("Your mobile or password dose not match."),o.processing=!1,a.password="")})}else alert("mobile & Password are required!")}}]),App.controller("ContactController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.question="",e.answer="",e.contactUpdate=function(o){if(console.log(o),e.new_contact=o,e.new_contact){e.loader=!0;var a={async:!0,crossDomain:!0,url:"http://medicalratios.net/Menas_health_Api/public/rest-api/v1/update/contact",method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+r.auth_token_name},processData:!1,data:JSON.stringify(e.new_contact),success:function(o){pagealert("Contact updated successfully!",{type:"Success",theme:"green",delay:3e3}),e.loader=!1,t.reload()},error:function(e){alert("Somthing went wrong!"),t.reload()}};$.ajax(a)}else alert("Please enter about Details!")},e.edit=function(t){console.log(t),e.new_contact=t,e.editcat=!0},o.faqs=[],e.loadCategory=function(){e.loader=!0,a.get(App.api+"contact").then(function(t){e.contact=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})},e.loadCategory()}]),App.controller("EnqueryController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loader=!0,a.get(App.api+"enquery").then(function(t){e.enqueries=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}),e.DeleteEnquery=function(o){console.log(o),e.new_enquery=o,e.new_enquery&&(e.loader=!0,a.post(App.api+"enquery/delete",{id:e.new_enquery.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.delete=function(t){console.log(t),e.new_enquery=t,e.deletecat=!0}}]),App.controller("FaqController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.question="",e.answer="",e.addFaq=function(o){e.faq=o,e.faq.question&&e.faq.answer?(e.btnDisable=!0,a.post(App.api+"add/faq",e.faq).then(function(o){e.faqs=o.data,alert("New Faq Create successfully!",{type:"Success:",theme:"green",delay:3e3}),t.reload(),e.btnDisable=!1},function(t){alert(t.data.message,{type:"Error",theme:"red",delay:3e3}),e.btnDisable=!1})):alert("Please enter category name!")},e.faqUpdate=function(o){if(console.log(o),e.new_faq=o,e.new_faq){e.loader=!0;var a={async:!0,crossDomain:!0,url:"http://medicalratios.net/Menas_health_Api/public/rest-api/v1/update/faq",method:"post",headers:{"content-type":"application/json",Authorization:"Bearer "+r.auth_token_name},processData:!1,data:JSON.stringify(e.new_faq),success:function(o){pagealert("Faq updated successfully!",{type:"Success",theme:"green",delay:3e3}),e.loader=!1,t.reload()},error:function(e){alert("Somthing went wrong!"),t.reload()}};$.ajax(a)}else alert("Please enter category name!")},e.DeleteFaq=function(o){console.log(o),e.new_faq=o,e.new_faq&&(e.loader=!0,a.post(App.api+"faq/delete",{id:e.new_faq.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.edit=function(t){console.log(t),e.new_faq=t,e.editcat=!0},e.delete=function(t){console.log(t),e.new_faq=t,e.deletecat=!0},o.faqs=[],e.loadCategory=function(){e.loader=!0,a.get(App.api+"faq").then(function(t){e.faqs=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})},e.loadCategory()}]),App.controller("MainController",["$scope","$state","$rootScope","$http","$localStorage","$interval",function(e,t,o,a,r,n){e.loadData=function(){a.get(App.api+"admin/notification",{id:r.notifi}).then(function(t){function a(){console.log("notification is shown!")}function r(){console.log("notification is closed!")}function n(){console.log("notification was clicked!")}function l(){console.error("Error showing notification. You may need to request permission.")}function i(){new Notify("Chatting",{body:e.notify,tag:e.notify_name,notifyShow:a,notifyClose:r,notifyClick:n,notifyError:l,timeout:4}).show()}e.messages=t.data,Notify.needsPermission?Notify.isSupported()&&Notify.requestPermission(function(){console.log("Permission has been granted by the user"),i()},function(){console.warn("Permission has been denied by the user")}):i(),$(".chat-widget").animate({scrollTop:$(".chat-widget").prop("scrollHeight")},500),o.msglenth=o.msglenth1})},o.auth_token_name=r.auth_token_name,r.auth_token_name&&void 0===o.currentUser&&(o.currentUser=r.currentUser=o.auth_token_name.users,o.logedIn=!0),e.logout=function(){window.localStorage.clear(),t.go("login"),alert("You are successfully Logout.!"),t.go("login")},e.mainMenu=[{label:"Profile",value:"mainLayout.profile",icon:"fa fa-user"},{label:"All Users",value:"mainLayout.users",icon:"fa fa-users"},{label:"Faq System",value:"mainLayout.faq",icon:"fa fa-question"},{label:"About",value:"mainLayout.about",icon:"fa fa-info-circle"},{label:"Contact",value:"mainLayout.contact",icon:"fa fa-address-book"},{label:"Enquery",value:"mainLayout.enquery",icon:"fa fa-pencil-square-o"},{label:"Questions",value:"mainLayout.question",icon:"fa fa-quora"},{label:"User Answer",value:"mainLayout.answer",icon:"fa fa-reply"},{label:"User Appointement",value:"mainLayout.appointment",icon:"fa fa-calendar"},{label:"Products",value:"mainLayout.product",icon:"fa fa-shopping-bag"},{label:"Add Notification",value:"mainLayout.notification",icon:"fa fa-bell"}]}]),App.controller("NotificationController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loadCategory=function(){e.loader=!0,a.get(App.api+"all/notification").then(function(t){e.products=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})},e.loadCategory(),e.DeleteFaq=function(o){console.log(o),e.new_product=o,e.new_product&&(e.loader=!0,a.post(App.api+"notification/delete",{id:e.new_product.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.save=function(o){e.product=o,e.product.title?(e.btnDisable=!0,a.post(App.api+"add/notification",e.product).then(function(o){e.products=o.data,alert("New Notification Create successfully!",{type:"Success:",theme:"green",delay:3e3}),t.reload(),e.btnDisable=!1},function(t){alert(t.data.message,{type:"Error",theme:"red",delay:3e3}),e.btnDisable=!1})):alert("Please enter Notification!")},e.delete=function(t){console.log(t),e.new_product=t,e.deletecat=!0},o.faqs=[]}]),App.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,a){var r=e(a.fileModel).assign;o.bind("change",function(){t.$apply(function(){r(t,o[0].files[0])})})}}}]),App.controller("ProductController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loadCategory=function(){e.loader=!0,a.get(App.api+"all/products").then(function(t){e.products=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})},e.loadCategory(),e.DeleteFaq=function(o){console.log(o),e.new_product=o,e.new_product&&(e.loader=!0,a.post(App.api+"product/delete",{id:e.new_product.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.edit=function(t){console.log(t),e.new_product=t,e.editcat=!0},e.delete=function(t){console.log(t),e.new_product=t,e.deletecat=!0},o.faqs=[]}]),App.directive("fileModel",["$parse",function(e){return{restrict:"A",link:function(t,o,a){var r=e(a.fileModel).assign;o.bind("change",function(){t.$apply(function(){r(t,o[0].files[0])})})}}}]),App.controller("ProfileController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.user=r.currentuser,console.log(e.user)}]),App.controller("QuestionController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loader=!0,a.get(App.api+"all/question").then(function(t){e.questions=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})})}]),App.controller("QuestionWithAnsController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loader=!0,a.get(App.api+"all/answer").then(function(t){e.answers=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}),e.DeleteAnswer=function(o){console.log(o),e.new_answer=o,e.new_answer&&(e.loader=!0,a.post(App.api+"answer/delete",{id:e.new_answer.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.delete=function(t){console.log(t),e.new_answer=t,e.deletecat=!0}}]),App.controller("usersController",["$scope","$state","$rootScope","$http","$localStorage",function(e,t,o,a,r){e.loader=!0,a.get(App.api+"users").then(function(t){e.users=t.data,e.loader=!1},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}),e.DeleteUser=function(o){console.log(o),e.new_user=o,e.new_user&&(e.loader=!0,a.post(App.api+"user/delete",{id:e.new_user.id}).then(function(o){e.appoitment=o.data,t.reload()},function(e){pagealert(e.data.message,{type:"Error",color:"red",delay:3e3})}))},e.delete=function(t){console.log(t),e.new_user=t,e.deletecat=!0}}]);